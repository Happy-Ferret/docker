<!DOCTYPE html>
<html>
<head>
  <title>fileSearch.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "extras/fileSearch/fileSearch.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

  <script src="../../fileSearch.js"></script>

  <link rel="stylesheet" href="../../fileSearch.css" />

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#filesearch.js">fileSearch.js</a>
      </div>

      <div class="heading h2">
        <a href="#escaperegex">escapeRegex</a>
      </div>

      <div class="heading h2">
        <a href="#chartype">charType</a>
      </div>

      <div class="heading h2">
        <a href="#comparecharacters">compareCharacters</a>
      </div>

      <div class="heading h2">
        <a href="#stripaccents">stripAccents</a>
      </div>

      <div class="heading h2">
        <a href="#bestrank">bestRank</a>
      </div>

      <div class="heading h2">
        <a href="#fuzzyscorestr">fuzzyScoreStr</a>
      </div>

      <div class="heading h2">
        <a href="#fuzzyscore">fuzzyScore</a>
      </div>

      <div class="heading h2">
        <a href="#right-thats-the-end-of-the-ranking-stuff">Right, that&#39;s the end of the ranking stuff</a>
      </div>

      <div class="heading h2">
        <a href="#dosearch">doSearch</a>
      </div>

      <div class="heading h2">
        <a href="#highlightstring">highlightString</a>
      </div>

      <div class="heading h2">
        <a href="#rendersearchresults">renderSearchResults</a>
      </div>

      <div class="heading h2">
        <a href="#selectindex">selectIndex</a>
      </div>

      <div class="heading h2">
        <a href="#selectnextitem">selectNextItem</a>
      </div>

      <div class="heading h2">
        <a href="#selectpreviouis">selectPreviouis</a>
      </div>

      <div class="heading h2">
        <a href="#searchformkeydown">searchFormKeyDown</a>
      </div>

      <div class="heading h2">
        <a href="#addevent">addEvent</a>
      </div>

      <div class="heading h2">
        <a href="#searchformsubmitted">searchFormSubmitted</a>
      </div>

      <div class="heading h2">
        <a href="#itemclicked">itemClicked</a>
      </div>

      <div class="heading h2">
        <a href="#showsearchbox">showSearchBox</a>
      </div>

      <div class="heading h2">
        <a href="#filesearch_kd">fileSearch_kd</a>
      </div>

      <div class="heading h2">
        <a href="#filesearch_kp">fileSearch_kp</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="filesearch.js">
  <h1>
    <a href="#filesearch.js" name="filesearch.js" class="pilcrow"></a>
fileSearch.js
  </h1>
</div>
<p>Contains methods for performing a fuzzy string search on file names
for easily jumping between files. The ranking algorithm is not based
on anything in particular - it's just a hack project that works reasonably
well. If anyone has any suggestions on how it can be improved, then
let me know.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Wrap everything inside a closure so we don't get any collisions in
the global scope</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="escaperegex">
  <h2>
    <a href="#escaperegex" name="escaperegex" class="pilcrow"></a>
escapeRegex
  </h2>
</div>
</div>
<div class="body">
<p>Escapes special characters in a string to use when creating a new RegExp</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">term</span>
<span class="dox_type">string</span>
<span>String to escape
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
<span>Regex-compatible escaped string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escapeRegex</span>(<span class="hljs-params">term</span>) </span>{
    <span class="hljs-keyword">return</span> term.replace(<span class="hljs-regexp">/[\[\]\{\}\(\)\^\$\.\*\+\|]/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-string">'\\'</span> + a;
    });
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>A few heper constants; they don't really do much, but they
indicate the corresponding rows and columns in the matrix below.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> UPPER = <span class="hljs-number">0</span>, LOWER = <span class="hljs-number">1</span>, NUMBER = <span class="hljs-number">2</span>, COMMON_DELIMS = <span class="hljs-number">3</span>, OTHER = <span class="hljs-number">4</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Amount by which one character stands out when compared
to another character. Row = character in question,
col = character to compare to. E.g. uppercase letter
stands out with a factor of 240 compared to lowercase letter.
These numbers are pretty much plucked out of thin air.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> relevanceMatrix = [
    [   <span class="hljs-number">0</span>, <span class="hljs-number">240</span>, <span class="hljs-number">120</span>, <span class="hljs-number">240</span>, <span class="hljs-number">220</span> ],
    [  <span class="hljs-number">20</span>,   <span class="hljs-number">0</span>,  <span class="hljs-number">20</span>, <span class="hljs-number">120</span>, <span class="hljs-number">120</span> ],
    [ <span class="hljs-number">140</span>, <span class="hljs-number">140</span>,   <span class="hljs-number">0</span>, <span class="hljs-number">140</span>, <span class="hljs-number">140</span> ],
    [ <span class="hljs-number">120</span>, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>,   <span class="hljs-number">0</span>, <span class="hljs-number">120</span> ],
    [ <span class="hljs-number">120</span>, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>, <span class="hljs-number">160</span>,   <span class="hljs-number">0</span> ]
  ];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="chartype">
  <h2>
    <a href="#chartype" name="chartype" class="pilcrow"></a>
charType
  </h2>
</div>
</div>
<div class="body">
<p>Categorizes a character as either lowercase, uppercase,
digit, strong delimiter, or other.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">c</span>
<span class="dox_type">string</span>
<span>The character to check
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">number</span>
<span>One of the constants defined above
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">charType</span>(<span class="hljs-params">c</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[a-z]/</span>.test(c)) <span class="hljs-keyword">return</span> LOWER;
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[A-Z]/</span>.test(c)) <span class="hljs-keyword">return</span> UPPER;
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[0-9]/</span>.test(c)) <span class="hljs-keyword">return</span> NUMBER;
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[\/\-_\.]/</span>.test(c)) <span class="hljs-keyword">return</span> COMMON_DELIMS;
    <span class="hljs-keyword">return</span> OTHER;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="comparecharacters">
  <h2>
    <a href="#comparecharacters" name="comparecharacters" class="pilcrow"></a>
compareCharacters
  </h2>
</div>
</div>
<div class="body">
<p>Compares a character to the characters before and
after it to see how much it stands out. For example
The letter B would stand out strongly in aBc</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">theChar</span>
<span class="dox_type">string</span>
<span>The character in question
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">before</span>
<span class="dox_type">string</span>
<span>The immediately preceding character
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">after</span>
<span class="dox_type">string</span>
<span>The immediately following character
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">number</span>
<span>Score according to how much the character stands out
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareCharacters</span>(<span class="hljs-params">theChar, before, after</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Grab the character types of all three characters</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> theType = charType(theChar),
      beforeType = charType(before),
      afterType = charType(after);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p><strong>MAGIC NUMBER ALERT</strong> 0.4 is a number that makes it work best in my tests</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> relevanceMatrix[theType][beforeType] +
     <span class="hljs-number">0.4</span> * relevanceMatrix[theType][afterType];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="stripaccents">
  <h2>
    <a href="#stripaccents" name="stripaccents" class="pilcrow"></a>
stripAccents
  </h2>
</div>
</div>
<div class="body">
<p>Replaces all accented characters in a string with their
unaccented equivalent.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">str</span>
<span class="dox_type">string</span>
<span>The input accented string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
<span>String with accents removed
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> stripAccents = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">accented, unaccented</span>) </span>{
    <span class="hljs-keyword">var</span> matchRegex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'['</span> + accented + <span class="hljs-string">']'</span>, <span class="hljs-string">'g'</span>),
      translationTable = {}, i;
    lookup = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chr</span>) </span>{
      <span class="hljs-keyword">return</span> translationTable[chr] || chr;
    };

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; accented.length; i += <span class="hljs-number">1</span>) {
      translationTable[accented.charAt(i)] = unaccented.charAt(i);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
      <span class="hljs-keyword">return</span> str.replace(matchRegex, lookup);
    };
  })(<span class="hljs-string">'àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ'</span>,
     <span class="hljs-string">'aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="bestrank">
  <h2>
    <a href="#bestrank" name="bestrank" class="pilcrow"></a>
bestRank
  </h2>
</div>
</div>
<div class="body">
<p>The real meat of this searching algorithm. Provides a score for a
given string against a given search term.</p>
<p>The <code>startingFrom</code> parameter is necessary (rather than just truncating
<code>item</code> so we can use the initial characters of <code>item</code> to provide better
context.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">item</span>
<span class="dox_type">string</span>
<span>The string to rank
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">term</span>
<span class="dox_type">string</span>
<span>The search term against which to rank it
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">startingFrom</span>
<span class="dox_type">number</span>
<span>Ignore the first <em>n</em> characters
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">object</span>
<span>Rank of <code>item</code> against <code>term</code> with highlights
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bestRank</span>(<span class="hljs-params">item, term, startingFrom</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>If we've reached the end of our search term, add some extra points for being short</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (term.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> startingFrom * <span class="hljs-number">100</span> / item.length;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>If we've reached the end of the item but not the term, then fail.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (item.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Quick sanity check to make sure the remaining item has all the characters we need in order</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!item.slice(startingFrom).match(
      <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>((<span class="hljs-string">'^.*'</span> + escapeRegex(term.split(<span class="hljs-string">''</span>).join(<span class="hljs-string">'~~K~~'</span>)) + <span class="hljs-string">'.*$'</span>).split(<span class="hljs-string">'~~K~~'</span>).join(<span class="hljs-string">'.*'</span>), <span class="hljs-string">'i'</span>)
    )) {
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Grab the first character that we're going to look at</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> firstSearchChar = term.charAt(<span class="hljs-number">0</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>These variables store our best guess so far, and the character
indices to which it applies</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> bestRankSoFar = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> highlights;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Now loop over the item, and test all instances of <code>firstSearchChar</code> (case-insensitive)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = startingFrom; i &lt; item.length; i += <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (item.charAt(i).toLowerCase() !== firstSearchChar.toLowerCase()) <span class="hljs-keyword">continue</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Find out what the rest of the string scores against the rest of the term</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> subsequentRank = bestRank(item.substr(i), term.slice(<span class="hljs-number">1</span>), <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (subsequentRank == -<span class="hljs-number">1</span>) <span class="hljs-keyword">continue</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Inverse linear score for the character. Earlier in string = much better</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> characterScore = <span class="hljs-number">400</span> / <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">1</span>, i);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>If, starting at this character, we have the whole of the search term in order, that's really
good. And if the term is really long, make it cubically good (quadratic scores added up)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (item.substr(i).toLowerCase().indexOf(term.toLowerCase()) === <span class="hljs-number">0</span>) characterScore += <span class="hljs-number">3</span> * term.length * term.length;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>Add on score for how much this character stands out</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      characterScore += compareCharacters(
        item.charAt(i),
        i === <span class="hljs-number">0</span> ? <span class="hljs-string">'/'</span> : item.charAt(i - <span class="hljs-number">1</span>),
        i === item.length - <span class="hljs-number">1</span> ? <span class="hljs-string">'/'</span> : item.charAt(i + <span class="hljs-number">1</span>)
      );

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Add on score from the rest of the string</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      characterScore += subsequentRank;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>If we've managed to better what we have so far, store it away</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (characterScore &gt; bestRankSoFar) {
        bestRankSoFar = characterScore;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Save highlighted characters as well</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        highlights = [ i ];
        <span class="hljs-keyword">var</span> subsequentHighlights = subsequentRank.highlights || [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; subsequentHighlights.length; j += <span class="hljs-number">1</span>) {
          highlights.push(subsequentHighlights[j] + i);
        }
      }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Return an object with valueOf so it can be directly compared using &lt; and &gt;
but also stores the highlight indices</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> {
      __score: bestRankSoFar,
      valueOf: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__score; },
      highlights: highlights
    };
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="fuzzyscorestr">
  <h2>
    <a href="#fuzzyscorestr" name="fuzzyscorestr" class="pilcrow"></a>
fuzzyScoreStr
  </h2>
</div>
</div>
<div class="body">
<p>Actual function to use when matching an item against a term
(bestRank should only be used internally)</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">item</span>
<span class="dox_type">string</span>
<span>Item to search
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">term</span>
<span class="dox_type">string</span>
<span>Term against which to search
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">object</span>
<span>Rank of <code>item</code> against <code>term</code> with highlights
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fuzzyScoreStr</span>(<span class="hljs-params">item, term</span>) </span>{
    <span class="hljs-keyword">return</span> bestRank(stripAccents(item), stripAccents(term), <span class="hljs-number">0</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="fuzzyscore">
  <h2>
    <a href="#fuzzyscore" name="fuzzyscore" class="pilcrow"></a>
fuzzyScore
  </h2>
</div>
</div>
<div class="body">
<p>Matches an object against a given term with particular weights being
applied to different properties. If the given item is instead a string,
just match it directly against the term.</p>
<p>The <code>relevances</code> parameter should be an object containing properties
with the same names as those on <code>item</code> that should be counted. For
example, a value of <code>{ propA: 2, propB: 1 }</code> would count matches in
<code>propA</code> twice as highly as matches in <code>propB</code>.</p>
<p>The returned <code>highlights</code> property contains arrays of character indices
to highlight in the term, indexed by the same property names</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">item</span>
<span class="dox_type">object</span>
<span>Item containing multiple properties to search
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">term</span>
<span class="dox_type">string</span>
<span>Term against which to search
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">relevances</span>
<span class="dox_type">object</span>
<span>Object congaining key/val pairs as above
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">object</span>
<span>Rank of <code>item</code> against <code>term</code> with highlights.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fuzzyScore</span>(<span class="hljs-params">item, term, relevances</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>If we have a string, just match it directly</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> item == <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> fuzzyScoreStr(item, term);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Initialize the return object</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> result = {
      __score: <span class="hljs-number">0</span>,
      valueOf: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__score; },
      highlights: {}
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Loop through all the specified properties</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> relevances) {
      <span class="hljs-keyword">if</span> (!relevances.hasOwnProperty(i) || !item.hasOwnProperty(i)) <span class="hljs-keyword">continue</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Grab the score for that particular property</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> thatScore = fuzzyScoreStr(item[i], term);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Add the rank on to the return object</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      result.__score += relevances[i] * thatScore;
      result.highlights[i] = thatScore &gt; <span class="hljs-number">0</span> ? thatScore.highlights : [];
    }

    <span class="hljs-keyword">return</span> result;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="right-thats-the-end-of-the-ranking-stuff">
  <h2>
    <a href="#right-thats-the-end-of-the-ranking-stuff" name="right-thats-the-end-of-the-ranking-stuff" class="pilcrow"></a>
Right, that's the end of the ranking stuff
  </h2>
</div>
<p>Now onwards to building it into our page!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Loop through the tree and parse it all into a big array</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> fileList = [];

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addDirToList</span>(<span class="hljs-params">dir, path</span>) </span>{
    <span class="hljs-keyword">if</span> (dir.dirs) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> dir.dirs)
        <span class="hljs-keyword">if</span> (dir.dirs.hasOwnProperty(i)) addDirToList(dir.dirs[i], path + i + <span class="hljs-string">'/'</span>);
    }
    <span class="hljs-keyword">if</span> (dir.files) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; dir.files.length; i += <span class="hljs-number">1</span>) fileList.push(path + dir.files[i]);
    }
  }

  addDirToList(tree, <span class="hljs-string">''</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Some variables to store the state of the search box</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> searchBoxShown = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> searchingTimeout, selectedSearchIndex, selectedItem;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="dosearch">
  <h2>
    <a href="#dosearch" name="dosearch" class="pilcrow"></a>
doSearch
  </h2>
</div>
</div>
<div class="body">
<p>Actually perform the file search</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSearch</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>Grab the search term from the input</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> term = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchbox'</span>).value;

    <span class="hljs-keyword">var</span> items = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Loop through all the files and rank them all</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fileList.length; i += <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">var</span> f = fileList[i];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Split up the file name so we can grab the base name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> parts = f.split(<span class="hljs-string">'/'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>This is the object that'll get passed to fuzzyScore</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> file = {
        fullPath: f,
        fileName: parts[parts.length - <span class="hljs-number">1</span>]
      };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Rank the file, primarily against the full path,
but if the file base name also matches, give it a
boost. 0.6 is a number that produces nice results</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> rank = fuzzyScore(file, term, {
        fullPath: <span class="hljs-number">1</span>,
        fileName: <span class="hljs-number">0.6</span>
      });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>If the file scores positively against the search, add it in</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (rank &gt; <span class="hljs-number">0</span>) {
        file.highlight = rank.highlights;
        file.score = +rank;
        items.push(file);
      }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Sort the items order of decreasing relevance</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    items.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
      <span class="hljs-keyword">if</span> (a.score &gt; b.score) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (a.score &lt; b.score) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>And render them all</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    renderSearchResults(items);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="highlightstring">
  <h2>
    <a href="#highlightstring" name="highlightstring" class="pilcrow"></a>
highlightString
  </h2>
</div>
</div>
<div class="body">
<p>Highlights the characters at given indices in a string</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">str</span>
<span class="dox_type">string</span>
<span>String to highlight
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">indexes</span>
<span class="dox_type">array</span>
<span>Array of indices to make bold
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
<span>HTML of string with given characters made bold
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlightString</span>(<span class="hljs-params">str, indexes</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>If there's nothing to do, return immediately</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!indexes || !indexes.length) <span class="hljs-keyword">return</span> str;

    <span class="hljs-keyword">var</span> out = <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>Loop through string one character at a time, highlighting as necessary</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; str.length; i += <span class="hljs-number">1</span>) {
      out += indexes.indexOf(i) !== -<span class="hljs-number">1</span> ? str.charAt(i).bold() : str.charAt(i);
    }
    <span class="hljs-keyword">return</span> out;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="rendersearchresults">
  <h2>
    <a href="#rendersearchresults" name="rendersearchresults" class="pilcrow"></a>
renderSearchResults
  </h2>
</div>
</div>
<div class="body">
<p>Renders the processed search items as HTML with highlighting
in the results list</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">items</span>
<span class="dox_type">array</span>
<span>Search results to render
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderSearchResults</span>(<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">var</span> html = <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>Loop through items, building up an HTML string</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length; i += <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">var</span> f = items[i];
      html += [
        <span class="hljs-string">'&lt;a class="item" data-value="'</span>, f.fullPath, <span class="hljs-string">'.html"&gt;'</span>,
          <span class="hljs-string">'&lt;span class="score"&gt;'</span>, ~~f.score, <span class="hljs-string">'&lt;/span&gt;'</span>,
          <span class="hljs-string">'&lt;span class="filename"&gt;'</span>, highlightString(f.fileName, f.highlight.fileName), <span class="hljs-string">'&lt;/span&gt;'</span>,
          <span class="hljs-string">'&lt;span class="fullpath"&gt;'</span>, highlightString(f.fullPath, f.highlight.fullPath), <span class="hljs-string">'&lt;/span&gt;'</span>,
        <span class="hljs-string">'&lt;/a&gt;'</span>
      ].join(<span class="hljs-string">''</span>);
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>Dump all the html into the results list</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchresults'</span>).innerHTML = html;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>Select the first item</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    selectIndex(<span class="hljs-number">0</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="selectindex">
  <h2>
    <a href="#selectindex" name="selectindex" class="pilcrow"></a>
selectIndex
  </h2>
</div>
</div>
<div class="body">
<p>Selects the search result at the given index in the list,
and deselcts any currently-selected item</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">idx</span>
<span class="dox_type">number</span>
<span>Index of the item to select
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectIndex</span>(<span class="hljs-params">idx</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>If another item is currently selected, deselect it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (selectedItem) selectedItem.className = selectedItem.className.replace(<span class="hljs-regexp">/\s?selected/</span>, <span class="hljs-string">''</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>Grab the search results straight from the DOM</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> r = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchresults'</span>);
    <span class="hljs-keyword">var</span> items = r.childNodes;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>If we actually have no items, there's not much we can do</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (items.length === <span class="hljs-number">0</span>) {
      selectedSearchIndex = -<span class="hljs-number">1</span>;
      selectedItem = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>Store the item and its index in helper variables</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    selectedSearchIndex = idx;
    <span class="hljs-keyword">var</span> s = selectedItem = items[idx];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>Select the item</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    s.className += <span class="hljs-string">' selected'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>Figure out whether or not the item is fully visible inside
the scrollable view, and if not, then scroll appropriately</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> o = s.offsetTop - r.offsetTop - r.scrollTop;
    <span class="hljs-keyword">if</span> (o &lt; <span class="hljs-number">0</span>) {
      r.scrollTop = s.offsetTop - r.offsetTop;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (o &gt; r.offsetHeight - s.offsetHeight) {
      r.scrollTop = o + r.scrollTop - r.offsetHeight + s.offsetHeight;
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="selectnextitem">
  <h2>
    <a href="#selectnextitem" name="selectnextitem" class="pilcrow"></a>
selectNextItem
  </h2>
</div>
</div>
<div class="body">
<p>Selects the result immediately after the currently selected item,
or the first item if the currently selected one is last in the list</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectNextItem</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchresults'</span>).childNodes;
    selectIndex((selectedSearchIndex + <span class="hljs-number">1</span>) % items.length);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="selectpreviouis">
  <h2>
    <a href="#selectpreviouis" name="selectpreviouis" class="pilcrow"></a>
selectPreviouis
  </h2>
</div>
</div>
<div class="body">
<p>Selects the result immediately preceding the currently selected item,
or the last item if the currently selected one is first in the list</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectPreviousItem</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> items = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchresults'</span>).childNodes;
    <span class="hljs-keyword">var</span> l = items.length;
    selectIndex((selectedSearchIndex + l - <span class="hljs-number">1</span>) % l);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="searchformkeydown">
  <h2>
    <a href="#searchformkeydown" name="searchformkeydown" class="pilcrow"></a>
searchFormKeyDown
  </h2>
</div>
</div>
<div class="body">
<p>Fired whenever a key is pressed on the search form and triggers
the necessary events</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">e</span>
<span class="dox_type">KeyDownEvent</span>
<span>The event object
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">searchFormKeyDown</span>(<span class="hljs-params">e</span>) </span>{
    e = e || <span class="hljs-built_in">window</span>.event;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>27 = escape, so hide the form</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">27</span>) {
      <span class="hljs-built_in">document</span>.body.removeChild(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'search'</span>));
      searchBoxShown = <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<p>40 = down arrow, select the next item</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">40</span>) {
      selectNextItem();
      e.preventDefault();
      e.stopPropagation();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>38 = up arrow, select the previous item</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.keyCode == <span class="hljs-number">38</span>) {
      selectPreviousItem();
      e.preventDefault();
      e.stopPropagation();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>Most likely a letter typed or deleted in the search box.
So queue another search</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    } <span class="hljs-keyword">else</span> {
      clearTimeout(searchingTimeout);
      searchingTimeout = setTimeout(doSearch, <span class="hljs-number">150</span>);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="addevent">
  <h2>
    <a href="#addevent" name="addevent" class="pilcrow"></a>
addEvent
  </h2>
</div>
</div>
<div class="body">
<p>Helper function for binding DOM events</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">Element</span>
<span>The DOM element to bind to
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">evt</span>
<span class="dox_type">string</span>
<span>The name of the event to bind to
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">func</span>
<span class="dox_type">function</span>
<span>Listener to attach to the event
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEvent</span>(<span class="hljs-params">obj, evt, func</span>) </span>{
    <span class="hljs-keyword">var</span> a;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<p>Sensible browsers use <code>addEventListener</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> ((a = obj.addEventListener)) {
      a.call(obj, evt, func, <span class="hljs-literal">false</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>IE uses <code>attachEvent</code></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    } <span class="hljs-keyword">else</span> {
      obj.attachEvent(<span class="hljs-string">'on'</span> + evt, func);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="searchformsubmitted">
  <h2>
    <a href="#searchformsubmitted" name="searchformsubmitted" class="pilcrow"></a>
searchFormSubmitted
  </h2>
</div>
</div>
<div class="body">
<p>Called when the user hits enter on the search form
so find the selected item and jump to that page</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">e</span>
<span class="dox_type">FormSubmitEvent</span>
<span>The submit event
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">searchFormSubmitted</span>(<span class="hljs-params">e</span>) </span>{
    e = e || <span class="hljs-built_in">window</span>.event;
    e.preventDefault();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<p>If there's no selected item, do nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!selectedItem) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<p>Otherwise, jump to the page</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">window</span>.location.href = relativeDir + selectedItem.getAttribute(<span class="hljs-string">'data-value'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="itemclicked">
  <h2>
    <a href="#itemclicked" name="itemclicked" class="pilcrow"></a>
itemClicked
  </h2>
</div>
</div>
<div class="body">
<p>Called when a search result item is clicked. So jump
to the relecant page using <a href="#searchformsubmitted.html">searchFormSubmitted</a></p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">e</span>
<span class="dox_type">MouseClickEvent</span>
<span>The mouse event
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">itemClicked</span>(<span class="hljs-params">e</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<p>Maximum number of levels to jump up the DOM tree</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> levels = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">var</span> target = (e || <span class="hljs-built_in">window</span>.event).target;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>The click event may have propagated from a child node,
so loop upwards until we actually find the result item</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">while</span> (levels-- &amp;&amp; target.tagName !== <span class="hljs-string">'A'</span>) target = target.parentNode;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<p>Set the selected item, then fire off the submit event on the form</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    selectedItem = target;
    searchFormSubmitted(e);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="showsearchbox">
  <h2>
    <a href="#showsearchbox" name="showsearchbox" class="pilcrow"></a>
showSearchBox
  </h2>
</div>
</div>
<div class="body">
<p>Constructs and shows the search box, optionally pre-populated
with a value for the search field</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">string</span>
<span>Pre-populated value for the search field
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showSearchBox</span>(<span class="hljs-params">val</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>If the box is already visible, do nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (searchBoxShown) <span class="hljs-keyword">return</span>;
    searchBoxShown = <span class="hljs-literal">true</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>Create the containing element</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> f = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    f.id = <span class="hljs-string">'search'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>Construct some basic HTML</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    f.innerHTML = [
      <span class="hljs-string">'&lt;div class="overlay"&gt;&lt;/div&gt;'</span>,
      <span class="hljs-string">'&lt;div class="box"&gt;'</span>,
        <span class="hljs-string">'&lt;form id="searchform"&gt;'</span>,
          <span class="hljs-string">'&lt;input id="searchbox" type="text" name="file" placeholder="Go to file..." autocomplete="off" value="'</span>, val, <span class="hljs-string">'"/&gt;'</span>,
        <span class="hljs-string">'&lt;/form&gt;'</span>,
        <span class="hljs-string">'&lt;div id="searchresults"&gt;&lt;/div&gt;'</span>,
      <span class="hljs-string">'&lt;/div&gt;'</span>
    ].join(<span class="hljs-string">''</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>Add the keydown event</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    addEvent(f, <span class="hljs-string">'keydown'</span>, searchFormKeyDown);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>Add the container straight onto the body</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">document</span>.body.appendChild(f);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>Focus the search field, and bind the necessary events</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchbox'</span>).focus();
    addEvent(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchform'</span>), <span class="hljs-string">'submit'</span>, searchFormSubmitted);
    addEvent(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'searchresults'</span>), <span class="hljs-string">'click'</span>, itemClicked);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>If we have a pre-populated value, also fire off a search immediately</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (val) doSearch();
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="filesearch_kd">
  <h2>
    <a href="#filesearch_kd" name="filesearch_kd" class="pilcrow"></a>
fileSearch_kd
  </h2>
</div>
</div>
<div class="body">
<p>Fired as a global keyDown event on the document. Checks
if ctrl/cmd+P has been pressed and shows the search form</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">e</span>
<span class="dox_type">KeyDownEvent</span>
<span>The key event
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fileSearch_kd</span>(<span class="hljs-params">e</span>) </span>{
    e = e || <span class="hljs-built_in">window</span>.event;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<p>80 = p, so listen for ctrl/cmd+P</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (e.keyCode === <span class="hljs-number">80</span> &amp;&amp; (e.ctrlKey || e.metaKey)) {
      showSearchBox();
      e.preventDefault();
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<div class="pilwrap" id="filesearch_kp">
  <h2>
    <a href="#filesearch_kp" name="filesearch_kp" class="pilcrow"></a>
fileSearch_kp
  </h2>
</div>
</div>
<div class="body">
<p>Fired as a global keyPress event. Checks to see if the key pressed
was a sensible character, and if so then shows the search box and
fires off the first search</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fileSearch_kp</span>(<span class="hljs-params">e</span>) </span>{
    e = e || <span class="hljs-built_in">window</span>.event;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>If there are any modifiers or if we're already entering text into
another input field elsewhere, then do nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (e.ctrlKey || e.altKey || e.metaKey || e.target.tagName === <span class="hljs-string">'INPUT'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<p>Grab the typed character, test it, and show the box if appropriate</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> theChar = <span class="hljs-built_in">String</span>.fromCharCode(e.which);
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/[a-zA-Z0-9\.\/\_\-]/</span>.test(theChar)) showSearchBox(theChar);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<p>Attach the global events to the document</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  addEvent(<span class="hljs-built_in">document</span>, <span class="hljs-string">'keydown'</span>, fileSearch_kd);
  addEvent(<span class="hljs-built_in">document</span>, <span class="hljs-string">'keypress'</span>, fileSearch_kp);
})();

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
